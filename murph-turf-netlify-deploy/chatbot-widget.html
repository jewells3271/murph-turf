<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot Widget</title>
</head>
<body>
    <script>
        (function() {
            // =============================================================
            // === IMPORTANT: PASTE YOUR OPENROUTER API KEY BELOW HERE ===
            // =============================================================
            const OPENROUTER_API_KEY = "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 "; // <--- REPLACE THIS WITH YOUR ACTUAL KEY
            // =============================================================
            // =============================================================

            // 1. CSS Styles (all inline for single file deployment)
            const styles = `
                /* Chat open button */
                #chat-open-btn {
                    position: fixed;
                    bottom: 20px;
                    right: 20px;
                    width: 60px;
                    height: 60px;
                    border-radius: 50%;
                    background-color: #007bff;
                    border: none;
                    cursor: pointer;
                    box-shadow: 0 2px 10px rgba(0,0,0,0.2);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 9999; /* Higher z-index */
                }
                #chat-open-btn img {
                    width: 40px;
                    height: 40px;
                }

                /* Chat widget container */
                #chat-widget-container {
                    position: fixed;
                    bottom: 90px; /* Position above the open button */
                    right: 20px;
                    z-index: 9999; /* Higher z-index */
                    transition: all 0.3s ease-in-out;
                    transform: translateY(100%);
                    opacity: 0;
                    visibility: hidden;
                }
                #chat-widget-container.open {
                    transform: translateY(0);
                    opacity: 1;
                    visibility: visible;
                }
                #chat-widget-container.hidden {
                    display: none; /* Fallback for immediate hiding */
                }

                /* Main chat container */
                #chat-container {
                    width: 350px;
                    height: 500px;
                    border-radius: 10px;
                    overflow: hidden;
                    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
                    display: flex;
                    flex-direction: column;
                    background: #fff;
                    font-family: 'Arial', sans-serif;
                    color: #333;
                }

                /* Chat header */
                #chat-header {
                    background-color: #007bff;
                    color: #fff;
                    padding: 10px 15px;
                    display: flex;
                    align-items: center;
                    justify-content: space-between;
                    border-bottom: 1px solid #0056b3;
                }
                #chat-header h3 {
                    flex-grow: 1;
                    text-align: center;
                    margin: 0;
                    font-size: 1.1em;
                }
                #avatar {
                    width: 40px;
                    height: 40px;
                    border-radius: 50%;
                    margin-right: 10px;
                    border: 2px solid #fff;
                }
                #chat-close-btn {
                    background: none;
                    border: none;
                    color: #fff;
                    font-size: 20px;
                    cursor: pointer;
                    padding: 5px;
                    transition: color 0.2s ease;
                }
                #chat-close-btn:hover {
                    color: #ddd;
                }

                /* Chat body and messages */
                #chat-body {
                    flex-grow: 1;
                    overflow-y: auto;
                    padding: 10px;
                    background-color: #e9ecef;
                    display: flex;
                    flex-direction: column;
                }
                #chat-messages {
                    display: flex;
                    flex-direction: column;
                    width: 100%;
                }
                .chat-message {
                    margin-bottom: 10px;
                    padding: 10px 15px;
                    border-radius: 18px;
                    max-width: 80%;
                    line-height: 1.4;
                    word-wrap: break-word;
                }
                .user-message {
                    background-color: #007bff;
                    color: #fff;
                    align-self: flex-end;
                    border-bottom-right-radius: 5px; /* Tweak for appearance */
                }
                .bot-message {
                    background-color: #f8f9fa;
                    color: #343a40;
                    align-self: flex-start;
                    border: 1px solid #dee2e6;
                    border-bottom-left-radius: 5px; /* Tweak for appearance */
                }

                /* Chat input area */
                #chat-input {
                    display: flex;
                    padding: 10px;
                    border-top: 1px solid #dee2e6;
                    background-color: #f8f9fa;
                }
                #user-input {
                    flex: 1;
                    border: 1px solid #ced4da;
                    border-radius: 20px;
                    padding: 10px 15px;
                    font-size: 0.9em;
                    margin-right: 10px;
                    transition: border-color 0.2s ease, box-shadow 0.2s ease;
                }
                #user-input:focus {
                    border-color: #007bff;
                    box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
                    outline: none;
                }
                #send-btn {
                    background-color: #007bff;
                    color: #fff;
                    border: none;
                    border-radius: 20px;
                    padding: 10px 18px;
                    font-size: 0.9em;
                    cursor: pointer;
                    transition: background-color 0.2s ease;
                }
                #send-btn:hover {
                    background-color: #0056b3;
                }
            `;

            // 2. HTML Structure (all inline for single file deployment)
            const chatHTML = `
                <button id="chat-open-btn">
                    <img src="https://murph-turf-dl.netlify.app/murph.png" alt="Chat" />
                </button>
                <div id="chat-widget-container" class="hidden">
                    <div id="chat-container">
                        <div id="chat-header">
                            <img src="https://murph-turf-dl.netlify.app/murph.png" alt="Murph Turf Avatar" id="avatar">
                            <h3>Murph Turf</h3>
                            <button id="chat-close-btn">X</button>
                        </div>
                        <div id="chat-body">
                            <div id="chat-messages"></div>
                        </div>
                        <div id="chat-input">
                            <input type="text" id="user-input" placeholder="Ask a question...">
                            <button id="send-btn">Send</button>
                        </div>
                    </div>
                </div>
            `;

            // 3. Knowledge Base (hardcoded for single file deployment)
            const knowledge = `
D&L Lawn Care

Skip to content

D&L Lawn Care

Spring/Fall Cleanup
Mulching
Lawn Care
Contact Us

Curb Appeal Is Our Priority

D&L Lawn Care started with a push mower and a dream. The dream was to provide exceptional lawn care services to the local community. We are a locally owned and operated business. We are fully insured.

Our Services

Spring/Fall Cleanup: We will clean up your yard and get it ready for the upcoming season. This includes leaf removal, and cleaning out flower beds.

Mulching: We will deliver and install mulch to your flower beds.

Lawn Care: We will mow, edge, and trim your lawn. We will also provide fertilization and weed control.

Contact Us

We would love to hear from you. Please fill out the form below and we will get back to you as soon as possible.

Name

Email

Message

Submit

D&L Lawn Care

A family-owned business that takes pride in our work.

Copyright Â© 2025 D&L Lawn Care
            `;

            // Inject CSS and HTML into the document
            function injectWidget() {
                const styleSheet = document.createElement("style");
                styleSheet.innerText = styles;
                document.head.appendChild(styleSheet);

                const chatWrapper = document.createElement("div");
                chatWrapper.innerHTML = chatHTML;
                document.body.appendChild(chatWrapper);

                // Get elements after they are injected
                const chatMessages = document.getElementById('chat-messages');
                const userInput = document.getElementById('user-input');
                const sendBtn = document.getElementById('send-btn');
                const openBtn = document.getElementById('chat-open-btn');
                const closeBtn = document.getElementById('chat-close-btn');
                const chatWidgetContainer = document.getElementById('chat-widget-container'); // Renamed for clarity

                sendBtn.addEventListener('click', sendMessage);
                userInput.addEventListener('keyup', (event) => {
                    if (event.key === 'Enter') sendMessage();
                });

                openBtn.addEventListener('click', () => {
                    chatWidgetContainer.classList.toggle('open');
                    chatWidgetContainer.classList.remove('hidden'); // Ensure hidden is removed if present
                    if(chatWidgetContainer.classList.contains('open')) {
                        chatMessages.scrollTop = chatMessages.scrollHeight; // Scroll to bottom on open
                    }
                });

                closeBtn.addEventListener('click', () => {
                    chatWidgetContainer.classList.remove('open');
                    // Optional: add 'hidden' after transition if desired for display:none
                    // setTimeout(() => chatWidgetContainer.classList.add('hidden'), 300);
                });

                function sendMessage() {
                    const userMessage = userInput.value;
                    if (userMessage.trim() === '') return;

                    appendMessage(userMessage, 'user');
                    userInput.value = '';

                    // Display a loading indicator immediately
                    const loadingMessageElement = document.createElement('div');
                    loadingMessageElement.classList.add('chat-message', 'bot-message');
                    loadingMessageElement.innerText = 'Murph is typing...';
                    loadingMessageElement.id = 'loading-message';
                    chatMessages.appendChild(loadingMessageElement);
                    chatMessages.scrollTop = chatMessages.scrollHeight;


                    fetch('https://openrouter.ai/api/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${OPENROUTER_API_KEY}`
                        },
                        body: JSON.stringify({
                            model: 'openai/gpt-3.5-turbo',
                            messages: [
                                { role: 'system', content: `You are Murph Turf, a friendly and helpful AI chatbot for D&L Lawn Care. Your knowledge base is: ${knowledge}` },
                                { role: 'user', content: userMessage }
                            ]
                        })
                    })
                    .then(response => response.json())
                    .then(data => {
                        // Remove loading indicator
                        if (document.getElementById('loading-message')) {
                            document.getElementById('loading-message').remove();
                        }
                        const botMessage = data.choices[0].message.content;
                        appendMessage(botMessage, 'bot');
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        // Remove loading indicator
                        if (document.getElementById('loading-message')) {
                            document.getElementById('loading-message').remove();
                        }
                        appendMessage('Sorry, something went wrong. Please try again later.', 'bot');
                    });
                }

                function appendMessage(message, sender) {
                    const messageElement = document.createElement('div');
                    messageElement.classList.add('chat-message', `${sender}-message`);
                    messageElement.innerText = message;
                    chatMessages.appendChild(messageElement);
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }

                // Initial greeting from Murph when the widget is loaded (but not yet open)
                // This message will appear once the user opens the chat.
                // We don't append it directly here, but wait for the widget to be opened.
                // Instead, we will add an initial greeting when the chat is opened for the first time.
                // Or, if you want an initial message when the page loads, uncomment the line below
                // appendMessage("Hi! I'm Murph, your friendly AI assistant. How can I help you today?", 'bot');

                // Initial bot greeting when the chat is first opened
                let firstOpen = true;
                openBtn.addEventListener('click', () => {
                    if (firstOpen) {
                        appendMessage("Hi! I'm Murph, your friendly AI assistant. How can I help you today?", 'bot');
                        firstOpen = false;
                    }
                });
            }

            // Inject the widget once the DOM is fully loaded
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', injectWidget);
            } else {
                injectWidget();
            }

        })();
    </script>
</body>
</html>
